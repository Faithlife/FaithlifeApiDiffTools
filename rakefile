require 'rake/clean'

task :default => [:build, :package]

def msbuild args = []
	sh "msbuild", *args
end

def nuget args = []
	sh "nuget", *args
end

desc "Cleans all apps"
task :clean do
	rm_rf "build"
	msbuild ["/p:Configuration=Release", "/t:Clean"]
end

desc "Builds all apps"
task :build => :restore_packages do
	msbuild "/p:Configuration=Release"
end

desc "Restore all nuget packages"
task :restore_packages do
	msbuild "/t:Restore"
end

desc "Create nuget packages"
task :package do
	mkdir_p "build"
	nuget ["pack", Dir.glob("*.nuspec").first, "-OutputDirectory", "build"]
end

desc "Publish nuget packages"
task :publish do
	files = Rake::FileList["build/*.nupkg"]
	for file in files do
		nuget ["push", file]
	end
end
